<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>visARC</title>
<style>
  body { background: #111; color: #eee; font-family: sans-serif; margin: 20px; }
  .example-pair { display: flex; flex-direction: row; gap: 10px; margin-bottom: 10px; }
  .section { margin-bottom: 40px; }
  .grid-wrap { display: flex; flex-wrap: wrap; gap: 20px; }
  .example { background: #222; padding: 10px; border-radius: 8px; border: 1px solid #555; }
  .label { font-weight: bold; margin-bottom: 5px; }
  table { border-collapse: collapse; margin: 0 auto; }
  td {
    width: 18px; height: 18px;
    text-align: center; vertical-align: middle;
    font-size: 10px; font-weight: bold;
    border: 1px solid #333;
    color: #000;
  }
  .mismatch td { border: 2px solid red !important; }
  input[type="file"], textarea { margin: 10px 0; }
  textarea { width: 100%; height: 100px; background: #222; color: #0f0; font-family: monospace; }
</style>
</head>
<body>
<h1>visARC</h1>
<label for="quizFile">Upload Quiz Puzzle (no final answer):</label><br>
<input type="file" id="quizFile" accept=".json"><br><br>
<label for="fullFile">Upload Full Puzzle (includes answer):</label><br>
<input type="file" id="fullFile" accept=".json"><br><br>
<label for="answerInput">Paste AI-Generated Answer for Test Output (JSON array):</label><br>
<textarea id="answerInput" placeholder="e.g. [[0,1,2],[3,4,5],[6,7,8]]"></textarea>
<button onclick="renderAnswer()">Render Answer</button>
<div id="output"></div>
<script>
const colorMap = {
  0: "#000000", 1: "#0074D9", 2: "#2ECC40", 3: "#FF4136", 4: "#FFDC00",
  5: "#AAAAAA", 6: "#F012BE", 7: "#FF851B", 8: "#7FDBFF", 9: "#870C25"
};
let quizData = null;
let fullData = null;
let answerCell = null;
function createTable(matrix) {
  const table = document.createElement("table");
  for (const row of matrix) {
    const tr = document.createElement("tr");
    for (const cell of row) {
      const td = document.createElement("td");
      td.style.backgroundColor = colorMap[cell] || "#000";
      td.textContent = cell;
      tr.appendChild(td);
    }
    table.appendChild(tr);
  }
  return table;
}
function arraysEqual(a, b) {
  return JSON.stringify(a) === JSON.stringify(b);
}
function renderPuzzle(data, container, labelPrefix, compareWith = null, isFull = false) {
  const section = document.createElement("div");
  section.className = "section";
  const gridWrap = document.createElement("div");
  gridWrap.className = "grid-wrap";
  for (let i = 0; i < data.train.length; i++) {
    const pair = data.train[i];
    const group = document.createElement("div");
    group.className = "example";
    group.innerHTML = `<div class="label">${labelPrefix} ${i + 1}</div>`;
    const inTable = createTable(pair.input);
    const outTable = createTable(pair.output);
    if (compareWith && !arraysEqual(pair.input, compareWith.train[i].input)) {
      inTable.classList.add("mismatch");
    }
    if (compareWith && !arraysEqual(pair.output, compareWith.train[i].output)) {
      outTable.classList.add("mismatch");
    }
    const row = document.createElement("div");
    row.className = "example-pair";
    row.appendChild(inTable);
    row.appendChild(outTable);
    group.appendChild(row);
    gridWrap.appendChild(group);
  }
  const test = document.createElement("div");
  test.className = "example";
  test.innerHTML = `<div class="label">${labelPrefix} Test</div>`;
  const testRow = document.createElement("div");
  testRow.className = "example-pair";
  const testIn = createTable(data.test[0].input);
  const testOut = createTable(data.test[0].output);
  if (compareWith && !arraysEqual(data.test[0].input, compareWith.test[0].input)) {
    testIn.classList.add("mismatch");
  }
  testRow.appendChild(testIn);
  testRow.appendChild(testOut);
  if (isFull) {
    answerCell = document.createElement("div");
    testRow.appendChild(answerCell);
  }
  test.appendChild(testRow);
  gridWrap.appendChild(test);
  section.appendChild(gridWrap);
  container.appendChild(section);
}
function renderAnswer() {
  if (!fullData || !answerCell) return;
  const text = document.getElementById("answerInput").value;
  try {
    const ans = JSON.parse(text);
    const correct = fullData.test[0].output;
    const table = createTable(ans);
    if (!arraysEqual(ans, correct)) {
      table.classList.add("mismatch");
    }
    answerCell.innerHTML = "<div class='label'>Your Answer</div>";
    answerCell.appendChild(table);
  } catch (e) {
    alert("Invalid JSON input.");
  }
}
document.getElementById("quizFile").addEventListener("change", function(e) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(evt) {
    quizData = JSON.parse(evt.target.result);
    const container = document.getElementById("output");
    const section = document.createElement("div");
    section.innerHTML = "<h2>Quiz Puzzle</h2>";
    container.appendChild(section);
    renderPuzzle(quizData, section, "Example");
  };
  reader.readAsText(file);
});
document.getElementById("fullFile").addEventListener("change", function(e) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(evt) {
    fullData = JSON.parse(evt.target.result);
    const container = document.getElementById("output");
    const section = document.createElement("div");
    section.innerHTML = "<h2>Full Puzzle (with Answer)</h2>";
    container.appendChild(section);
    renderPuzzle(fullData, section, "Example", quizData, true);
  };
  reader.readAsText(file);
});
</script>
</body>
</html>
