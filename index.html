
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ARC Puzzle Visualizer</title>
<style>
  body { background: #111; color: #eee; font-family: sans-serif; margin: 20px; }
  .grid-container { display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 40px; }
  .example { border: 1px solid #555; padding: 10px; background: #222; border-radius: 8px; }
  .label { font-weight: bold; margin-bottom: 5px; }
  table { border-collapse: collapse; margin: 5px; }
  td {
    width: 20px; height: 20px;
    text-align: center; vertical-align: middle;
    font-size: 12px; font-weight: bold;
    border: 1px solid #333;
    color: #000;
  }
  .mismatch td { border: 2px solid red !important; }
  input[type="file"], textarea { margin: 10px 0; }
  textarea { width: 100%; height: 100px; background: #222; color: #0f0; font-family: monospace; }
</style>
</head>
<body>

<h1>ARC Puzzle Visualizer</h1>
<label for="quizFile">Upload Quiz Puzzle (no final answer):</label><br>
<input type="file" id="quizFile" accept=".json"><br><br>

<label for="fullFile">Upload Full Puzzle (includes answer):</label><br>
<input type="file" id="fullFile" accept=".json"><br><br>

<label for="answerInput">Paste AI-Generated Answer for Test Output (JSON array):</label><br>
<textarea id="answerInput" placeholder="e.g. [[0,1,2],[3,4,5],[6,7,8]]"></textarea>
<button onclick="renderAnswer()">Render Answer</button>

<div id="output"></div>

<script>
const colorMap = {
  0: "#000000", 1: "#0074D9", 2: "#2ECC40", 3: "#FF4136", 4: "#FFDC00",
  5: "#AAAAAA", 6: "#F012BE", 7: "#FF851B", 8: "#7FDBFF", 9: "#870C25"
};

let quizData = null;
let fullData = null;
let answerCell = null;

function createTable(matrix) {
  const table = document.createElement("table");
  for (const row of matrix) {
    const tr = document.createElement("tr");
    for (const cell of row) {
      const td = document.createElement("td");
      td.style.backgroundColor = colorMap[cell] || "#000";
      td.textContent = cell;
      tr.appendChild(td);
    }
    table.appendChild(tr);
  }
  return table;
}

function arraysEqual(a, b) {
  return JSON.stringify(a) === JSON.stringify(b);
}

function renderPuzzle(data, container, labelPrefix, compareWith = null, isFull = false) {
  const wrapper = document.createElement("div");
  const gridContainer = document.createElement("div");
  gridContainer.className = "grid-container";

  data.train.forEach((pair, idx) => {
    const ex = document.createElement("div");
    ex.className = "example";
    ex.innerHTML = `<div class="label">${labelPrefix} ${idx + 1}</div>`;
    const inTable = createTable(pair.input);
    const outTable = createTable(pair.output);

    if (compareWith && !arraysEqual(pair.input, compareWith.train[idx].input)) {
      inTable.classList.add("mismatch");
    }
    if (compareWith && !arraysEqual(pair.output, compareWith.train[idx].output)) {
      outTable.classList.add("mismatch");
    }

    ex.appendChild(inTable);
    ex.appendChild(outTable);
    gridContainer.appendChild(ex);
  });

  const test = document.createElement("div");
  test.className = "example";
  test.innerHTML = `<div class="label">${labelPrefix} Test</div>`;
  const testInTable = createTable(data.test[0].input);
  const testOutTable = createTable(data.test[0].output);

  if (compareWith && !arraysEqual(data.test[0].input, compareWith.test[0].input)) {
    testInTable.classList.add("mismatch");
  }

  test.appendChild(testInTable);
  test.appendChild(testOutTable);

  if (isFull) {
    answerCell = document.createElement("div");
    test.appendChild(answerCell); // placeholder for answer rendering
  }

  gridContainer.appendChild(test);
  wrapper.appendChild(gridContainer);
  container.appendChild(wrapper);
}

function renderAnswer() {
  if (!fullData || !answerCell) return;
  const text = document.getElementById("answerInput").value;
  try {
    const ans = JSON.parse(text);
    const correct = fullData.test[0].output;
    const table = createTable(ans);

    if (!arraysEqual(ans, correct)) {
      table.classList.add("mismatch");
    }

    answerCell.innerHTML = "<div class='label'>Your Answer</div>";
    answerCell.appendChild(table);
  } catch (e) {
    alert("Invalid JSON input.");
  }
}

document.getElementById("quizFile").addEventListener("change", function(e) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(evt) {
    quizData = JSON.parse(evt.target.result);
    const container = document.getElementById("output");
    const section = document.createElement("div");
    section.innerHTML = "<h2>Quiz Puzzle</h2>";
    container.appendChild(section);
    renderPuzzle(quizData, section, "Example");
  };
  reader.readAsText(file);
});

document.getElementById("fullFile").addEventListener("change", function(e) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(evt) {
    fullData = JSON.parse(evt.target.result);
    const container = document.getElementById("output");
    const section = document.createElement("div");
    section.innerHTML = "<h2>Full Puzzle (with Answer)</h2>";
    container.appendChild(section);
    renderPuzzle(fullData, section, "Example", quizData, true);
  };
  reader.readAsText(file);
});
</script>
</body>
</html>
